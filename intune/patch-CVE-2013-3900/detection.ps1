
try {
    $paths = @(
        "HKLM:\Software\Microsoft\Cryptography\Wintrust\Config",
        "HKLM:\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config"
    )

    $desiredValue = 1
    $allCompliant = $true
    $complianceOutput = @() # To store detailed messages

    foreach ($path in $paths) {
        $isValueCompliant = $false
        try {
            $currentValue = (Get-ItemProperty -Path $path -Name "EnableCertPaddingCheck" -ErrorAction Stop).EnableCertPaddingCheck
            
            if ($currentValue -eq $desiredValue) {
                $complianceOutput += "PASS: Value at '$path' is correctly set to '$desiredValue'."
                $isValueCompliant = $true
            }
            else {
                $complianceOutput += "FAIL: Value at '$path' is '$currentValue' but should be '$desiredValue'."
            }
        }
        catch {
            $complianceOutput += "FAIL: Registry value 'EnableCertPaddingCheck' not found at '$path'."
        }
        
        if (-not $isValueCompliant) {
            $allCompliant = $false
        }
    }

    $complianceOutput | ForEach-Object { Write-Output $_ }

    if ($allCompliant) {
        Write-Output "Overall Status: Compliant"
        exit 0
    }
    else {
        Write-Output "Overall Status: Non-Compliant"
        exit 1
    }
}
catch {
    Write-Output "An unexpected error occurred during detection: $_"
    exit 1
}